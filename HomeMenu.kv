#:kivy 1.9.0
#:import utils kivy.utils
#:import c colors
#:import f fonts
#:import pf pamFunctions
#:import w display.Window

#Authored and refactored by Michael Tanner
# =============================================================================
#-----GUI MARKUP FOR THE HOME MENU-----
# =============================================================================

#This module contains the kivy markup language for the Super PAM Home Menu
#Each section covers the style rules for a different component of the menu.
#Toward the end of the module lies the style rules for the MainMenuLayout, which will contain 
#the arrangement of all other PAM components.

#For more information on the behavior of these components, refer to the PAM Widgets module

MainMenuLayout:
# =============================================================================
# Labels
# =============================================================================
<PAMAccordionItemTitle@Label>:
    text: ctx.title
    canvas.before:
        Color:
            rgb: 1, 1, 1
        BorderImage:
            source:
                ctx.item.background_normal                         if ctx.item.collapse                         else ctx.item.background_selected
            pos: self.pos
            size: self.size
        PushMatrix
        Translate:
            xy: self.center_x, self.center_y
        Rotate:
            angle: 90 if ctx.item.orientation == 'horizontal' else 0
            axis: 0, 0, 1
        Translate:
            xy: -self.center_x, -self.center_y
    canvas.after:
        PopMatrix


<ScaleLabel>:
	_scale: 1. if self.texture_size[0] < self.width else float(self.width) / (self.texture_size[0]+0.1)
	canvas.before:
		PushMatrix
		Scale:
			origin: self.center
			x: self._scale or 1.
			y: self._scale or 1.
	canvas.after:
		PopMatrix
# =============================================================================
# Buttons
# =============================================================================
<ScaleButton>:
	state_image: self.background_normal if self.state == 'normal' else self.background_down
	disabled_image: self.background_disabled_normal if self.state == 'normal' else self.background_disabled_down
	_scale: 1. if self.texture_size[0] < self.width else float(self.width) / (self.texture_size[0]+0.1)
	canvas:
		Color:
			rgba: self.background_color
		BorderImage:
			border: self.border
			pos: self.pos
			size: self.size
			source: self.disabled_image if self.disabled else self.state_image
            auto_scale: 'both_lower'
		PushMatrix
		Scale:
			origin: self.center
			x: self._scale or 1.
			y: self._scale or 1.
		Color:
			rgba: self.disabled_color if self.disabled else self.color
		Rectangle:
			texture: self.texture
			size: self.texture_size
			pos: int(self.center_x - self.texture_size[0] / 2.), int(self.center_y - self.texture_size[1] / 2.)
		PopMatrix
<PAMButton>:
    font_scale: self.font_scale
    font_size: self.width * 0.1 * self.font_scale
<PAMActionButton>:
    size_hint: 0.3, 0.3
    background_color: 0, 0, 0, 0
    action_image: self.action_image
    d_color: self.d_color
    scale_factor: self.scale_factor
    canvas:
        Rectangle:
            source: self.action_image
            pos: (self.pos[0]+self.size[0]/2.0) - 40, (self.pos[1]+self.size[1]/2.0) - 40
            size: (self.parent.width*self.scale_factor*self.select_scale, self.parent.width*self.scale_factor*self.select_scale)

# =============================================================================
# Game Carousel
# =============================================================================
<GameCarousel>:
<GameCarouselItem>:
    font_scale: self.font_scale
    font_size: self.height * 0.5 * self.font_scale
    size_hint: 1, 1
# =============================================================================
# Sidebar
# =============================================================================
<SideBar>:
    size_hint: 0.33, 0.8#0.23, 0.25
    pos_hint: {'right':0.4, 'top':0.89}
    on_pos: pos={self.parent.x, self.parent.y}
<SideBarTab>:
    size_hint: 0.6, 0.13
    text_size: self.width, self.height
    halign: 'left' 
<SideBarTabItem>:
    size_hint: 0.6, 0.16
    pos_hint: {'x': 0.54, 'top': 0.5}
    text_size: self.width, self.height
    halign: 'left' 
    valign: 'center'
    padding: 20, 20
<TabItemContainer@BoxLayout>:
    orientation: 'vertical'
    size_hint: 1, 1
    padding: 20

# =============================================================================
# Game Information
# =============================================================================
<GameDescriptionArea>:
    orientation: 'vertical'
    size_hint: 0.86, 0.38
    pos_hint: {'right': 1, 'top': 1}

<GameTitle>:
    text_size: self.size
    font_scale: self.font_scale
    font_size: self.height * 0.5 * self.font_scale
    bold: True
    halign: 'center'
    valign: 'top'
    size_hint: 0.5, 0.13

<GameInfo>:
    size_hint: 1, 0.2
    font_scale: self.font_scale
    text_size: self.size
    font_size: self.height * 0.5 * self.font_scale
    halign: 'left'   
    valign: 'top'


# =============================================================================
# Game Video
# =============================================================================
<PAMVideo>:
    size_hint: 0.86, 0.29
    pos_hint: {'right': 1, 'top': 1}

# =============================================================================
# Control Bar
# =============================================================================
<ControlBar>:
    orientation: 'horizontal'
    size_hint: 1, 0.08
    barcolor: self.barcolor
<ControlBarItem>:
    font_size: self.height * 0.5
<ControlBarIcon@Image>:

# =============================================================================
# Home Menu
# =============================================================================
<MainMenuLayout>:
    id: main
    PAMKeyboardListener:
        id: kListener
        size_hint: 0, 0
    BoxLayout:
        orientation: 'vertical'    
        BoxLayout:
            orientation:'horizontal'
            size_hint: 1, 0.84
            SideBar:
                id: sidebarSection
                orientation: 'vertical'
                opacity: 0.5
                SidebarCarousel:
                    id: car
                    loop: True
                    direction: 'right'
                    size_hint: 1, 1
                    pos_hint: {'x': -0.1}
                    Accordion:
                        id: sidebar
                        orientation: 'vertical'
                        bar_id: 'rootSidebar'
                        
                       
                        SideBarTab:
                            title: 'SORT GAMES'
                            font_name: 'Roboto'
                            font: self.font_name
                            func_id: 'sort'
                            highlighted: True
                            orientation: 'vertical'
                            TabItemContainer:
                                SideBarTabItem:
                                    text:'By Favorites'
                                    command: lambda menu, *args: pf.sortByFavorite(menu.game_list, menu)
                                SideBarTabItem:
                                    text:'By Title'
                                    command: lambda menu, *args: pf.sortByTitle(menu.game_list)
                                SideBarTabItem:
                                    text: 'By Year'
                                    command: lambda menu, *args: pf.sortByYear(menu.game_list)
                                SideBarTabItem:
                                    text:'By Developer'
                                    command: lambda menu, *args: pf.sortByDev(menu.game_list)
                                SideBarTabItem:
                                    text: 'By Publisher'
                                    command: lambda menu, *args: pf.sortByPub(menu.game_list)
                        SideBarTab:
                            title:'OPTIONS'
                            func_id: 'op'
                            TabItemContainer:
                                SideBarTabItem:
                                    text: 'Sound'
                                    func_id: 'sound'
                                SideBarTabItem:
                                    text: 'Visuals'
                                    func_id: 'visuals'
                                SideBarTabItem:
                                    text: 'Data'
                                    func_id: 'user'
                                SideBarTabItem:
                                    text: 'Inputs'
                                    func_id: 'inputs'

                        SideBarTab:
                            title: 'POWER'
                            func_id: 'power'
                            BoxLayout:
                                orientation:'vertical'

                                
                
                    Accordion:
                        id: soundSidebar
                        orientation: 'vertical'
                        bar_id: 'sound'
                        SideBarTab:
                            title: 'SOUND'
                            TabItemContainer:
                                SideBarTabItem:
                                    text: 'Mute Video'
                                SideBarTabItem:
                                    text: 'Mute SFX'
                                    command: lambda menu, *args: pf.muteSound(menu, self)
                    Accordion:
                        id: visualsSidebar
                        orientation: 'vertical'
                        bar_id: 'visuals'
                        SideBarTab:
                            title: 'Color Scheme'
                            TabItemContainer:
                                SideBarTabItem:
                                    text: 'Waves'
                                    command: lambda menu, *args: pf.setColorScheme(menu, self.text)
                                SideBarTabItem:
                                    text: 'Watermelon'
                                    command: lambda menu, *args: pf.setColorScheme(menu, self.text)
                                SideBarTabItem:
                                    text: 'Pumpkin'
                                    command: lambda menu, *args: pf.setColorScheme(menu, self.text)
                                SideBarTabItem:
                                    text: 'Rose'
                                    command: lambda menu, *args: pf.setColorScheme(menu, self.text)
                        SideBarTab:
                            title: 'Font Size'
                            TabItemContainer:
                                SideBarTabItem:
                                    text: 'Small'
                                    command: lambda menu, *args: pf.setFontSize(menu, self.text)
                                SideBarTabItem:
                                    text: 'Medium'
                                    command: lambda menu, *args: pf.setFontSize(menu, self.text)
                                SideBarTabItem:
                                    text: 'Large'
                                    command: lambda menu, *args: pf.setFontSize(menu, self.text)
                        SideBarTab:
                            title: 'Font Type'
                            TabItemContainer:
                                SideBarTabItem:
                                    text: 'Roboto'
                                    command: lambda menu, *args: pf.setFontType(menu, self.text)
                                SideBarTabItem:
                                    text: 'Arial'
                                    command: lambda menu, *args: pf.setFontType(menu, self.text)
                                SideBarTabItem:
                                    text: 'Verdana'
                                    command: lambda menu, *args: pf.setFontType(menu, self.text)
                                SideBarTabItem:
                                    text: 'OpenDyslexic'
                                    command: lambda menu, *args: pf.setFontType(menu, self.text)
                    Accordion:
                        id: userSidebar
                        orientation: 'vertical'
                        bar_id: 'user'
                        SideBarTab:
                            title: 'DATA'
                            TabItemContainer:
                                SideBarTabItem:
                                    text: 'Empty Favorites'
                                    command: lambda menu, *args: pf.emptyFavorites(menu)
                                SideBarTabItem:
                                    text: 'Defaults'
                                    command: lambda menu, *args: pf.revertToDefaults(menu)
                    Accordion:
                        id: inputsSidebar
                        orientation: 'vertical'
                        bar_id: 'inputs'
                        SideBarTab:
                            title: 'Turbo Button'
                            TabItemContainer:
                                SideBarTabItem:
                                    text: 'ON'
                                SideBarTabItem:
                                    text: 'OFF'
                                
            GameCarousel:
                id: games
                orientation: 'vertical'
                size_hint: 0.28, 1
                pos_hint: {'center_x': 0.5, 'top': 1}
                        
            BoxLayout:
                id: gameDetails
                orientation: 'vertical'
                size_hint: 0.33, 0.84
                pos_hint: {'right': 1, 'top': 0.93}
                spacing: 30
                BoxLayout:
                    id: imageArea
                    orientation:'horizontal'
                    size_hint: 0.84, 0.50
                    pos_hint: {'right': 0.93}

                    PAMImage:
                        id: gameImage
                        source: self.bg_image
                        stretch: True
                        allow_stretch: True

                GameDescriptionArea:
                    id: gameDescArea
                    GameInfo:
                        id: dev
                        text: "Developer:"
                    GameInfo:
                        id: pub
                        text: "Publisher:"
                    GameInfo:
                        id: year
                        text: "Year:"
                PAMButtonGroup:
                    id: actionbtns
                    opacity: 0.5
                    orientation: 'horizontal'
                    size_hint: 1, 0.19
                    pos_hint: {'right': 1, 'top': 1}
                    PAMActionButton:
                        id: play
                        func_id: 'play'
                        d_color: '#FFFFFF00'
                        d_action: c.getColor('play-d')
                        h_action: c.getColor('play-h')
                        s_action: c.getColor('play-s')
                        action_image: self.d_action
                    PAMActionButton:
                        id: fav
                        func_id: 'fav'
                        d_color: '#FFFFFF00'
                        d_action: c.getColor('fav-d')
                        h_action: c.getColor('fav-h')
                        s_action: c.getColor('fav-s')
                        action_image: self.d_action
        
        ControlBar:
            id: controlbar
            canvas.before:
                Color:
                    rgb: self.bg_color         
                Rectangle:
                    pos: self.pos
                    size: self.width, self.height

            ControlBarItem:
                id: btn1
                text:"Play:"
                text_size: self.size
                halign: 'right'
                valign: 'middle'
            Image:
                source: 'img/ControlBar1.png'
                halign: 'left'
                valign: 'middle'
                
            ControlBarItem:
                id: btn2
                text: "Close:"
                text_size: self.size
                halign: 'right'
                valign: 'middle'
            Image:
                source: 'img/ControlBar2.png'

            ControlBarItem:
                id: btn3
                text: "Favorite:"
                text_size: self.size
                halign: 'right'
                valign: 'middle'
            Image:
                source: 'img/ControlBar3.png'


# =============================================================================
# Overlay Layer
# =============================================================================
    BoxLayout:
        id: dark
        size_hint: None, None
        opacity: 0
        disabled: True
        orientation:'horizontal'
        size_hint: 1, 1
        canvas:
            Color: 
                rgba: 0, 0, 0, 0.5
            Rectangle:
                size: self.size
                pos: self.pos
    BoxLayout:
        id: load
        size_hint: None, None
        opacity: 1
        orientation:'horizontal'
        size_hint: 1, 1
        disabled: False
        canvas:
            Color: 
                rgba: utils.get_color_from_hex('#101216FF')
            Rectangle:
                size: self.size
                pos: self.pos
        Label:
            id: logo
            markup: True
            opacity: 0
            text: 'Super[b]PAM[/b]'
            size_hint: 1, 1
            font_size: 60
            color: utils.get_color_from_hex('#FFFFFFFF')

        